<?php
$post['id']='12';
$post['title']='Відмінювання слова «коментар» у Disqus';
$post['text']='<div align="center"><img src="https://poohitan.com/images/DISQUS-300x294.png"><br></div><br>Як і майже у всіх платформах коментування, в <a href="http://disqus.com/websites/" target="" title="">Disqus</a> є проблема з відмінюванням кількості коментарів. В англійській мові з одниною і множиною все просто, є <b>comment</b>, і є <b>comments</b>. Розробники переважно не вникають в особливості інших мов, і дозволяють тільки три опції для відображення кількості коментарів — опція для однини, опція для множини, і ше одна опція, коли коментарів зовсім нема. Англійською все добре:<br><br><blockquote>None comments<br>One comment<br>%num% comments</blockquote><br>Але в багатих слов’янських мовах з’являються проблеми, трьох опцій не досить, може бути і <b>коментар</b>, і <b>коментарі</b>, і <b>коментарів</b>. Це вже три опції + треба ше одну для нуля коментарів. Тому<br><br><blockquote>%num% коментарів</blockquote><br>перетворюється на:<br><br><blockquote>2 коментарів</blockquote><br>Шо невимовно бісить, доводиться викручуватись якось так:<br><br><blockquote>%num% коментарі(в)</blockquote><br>або<br><br><blockquote>Коментарів: %num%</blockquote><br>А це теж чіпляє чутливу душу граматичного нациста, хочеться нормальних людських відмінювань.<br><br>Тепер по суті. Виправити це в <b>Disqus </b>можна, якщо трошки підправити деякі скрипти. <cut><span id="cut"><img id="scissors" src="templates/cut.png" border="0"></span><br><br>На <a target="" title="" href="http://poohitan.disqus.com/admin/settings/">сторінці налаштувань Disqus</a> є доступ до цих самих трьох опцій, але нам їх мало, тому треба знайти спосіб виводити кількість коментарів правильно.<br>Який взагалі у <b>Disqus </b>механізм відображення кількості коментарів до запису. Нехай запис знаходиться на сторінці <b>http://example.com/post.html</b>. Тоді в тому місці, де треба вивести к-сть коментарів, треба додати щось таке:<br><br><div class="pastebin">Код з <a href="http://pastebin.com/gz7qQ2ub">http://pastebin.com/gz7qQ2ub</a></div><script src="https://pastebin.com/embed_js.php?i=gz7qQ2ub"></script><br>І в футері сторінки вставити такий скрипт:<br><br><div class="pastebin">Код з <a href="http://pastebin.com/n9Bs0Mp1">http://pastebin.com/n9Bs0Mp1</a></div><script src="https://pastebin.com/embed_js.php?i=n9Bs0Mp1"></script><br>Цей скрипт проходиться по сторінці, шукає всі посилання, <b>href </b>яких містить <b>#disqus_thread</b>, йде на сервер <b>Disqus</b>\'у, десь там дивиться, скільки є коментарів до запису з такою адресою, а тоді заміняє вміст тих посилань на власне кількість коментарів. <br><br>Бачимо, що у цьому скрипті нічого схожого на виведення кількості комнтарів нема, але він звертається до іншого скрипта <b>count.js</b>, вочевидь, там все і відбувається. Йдемо за адресою, там такий скрипт без whitespace\'ів.<br><br><div class="pastebin">Код з <a href="http://pastebin.com/QQceF1VD">http://pastebin.com/QQceF1VD</a></div><script src="https://pastebin.com/embed_js.php?i=QQceF1VD"></script><br>Пропускаємо його через <a target="" title="" href="http://jsbeautifier.org/">jsbeautifier.org</a>, отримуємо таке:<br><br><div class="pastebin">Код з <a href="http://pastebin.com/9sAAiYNk">http://pastebin.com/9sAAiYNk</a></div><script src="https://pastebin.com/embed_js.php?i=9sAAiYNk"></script><br>В це теж не хочеться вникати, незрозумілі назви змінних і всяке таке. Якщо поверхнево, то є дві функції, <b>getCount()</b> i <b>displayCount()</b>. Логічно припустити, шо нам треба <b>displayCount()</b>. Бачимо там такий шматок коду:<br><br><div class="pastebin">Код з <a href="http://pastebin.com/J9fpACED">http://pastebin.com/J9fpACED</a></div><script src="https://pastebin.com/embed_js.php?i=J9fpACED"></script><br>Здається, тут якраз і відбувається те, шо нам треба. Є якесь <b>b.comments</b>, очевидно, шо це і є кількість коментарів до запису, бо далі в <b>switch </b>там перебираються випадки 0, 1 і решта. Після <b>switch</b> відбувається ше якась фігня, а потім в циклі ше шось. Можу тільки здогадуватись, шо там у змінних <b>a</b>, <b>b</b>, <b>c</b> i <b>d</b>, але це не суттєво, ніколи не треба без потреби розбиратись в чужому коді :). Достатньо бачити, що десь звідкись береться кількість коментарів, потім в циклі в якихось об’єктів заміняється <b>innerHTML</b>. Ясно, що ті об’єкти — це і є посилання з <b>#disqus_thread</b>, і їх вміст міняється на кількість коментарів. Отже в тому <b>for </b>нам треба міняти <b>c<span class="br0">[</span>d<span class="br0">]</span>.<span class="me1">innerHTML</span></b> на правильну кількість коментарів замість тої, яку видає <b>Disqus</b>. Переписуємо функцію <b>displayCount()</b> по-своєму:<br><br><div class="pastebin">Код з <a href="http://pastebin.com/XabMEgnC">http://pastebin.com/XabMEgnC</a></div><script src="https://pastebin.com/embed_js.php?i=XabMEgnC"></script><br>Круто, тепер треба, щоб <b>Disqus </b>звертався до нашого скрипта, а не до свого. Повертаємось до того скрипта, що у футері сайту, міняємо там рядок з адресою потрібного скрипта. Хоч він знаходиться нижче коментаря <i>«<span class="coMULTI">/* * * DON\'T EDIT BELOW THIS LINE * * */</span>»</i>. Правила деколи треба порушувати :)<br><br><div class="pastebin">Код з <a href="http://pastebin.com/rJgM50FV">http://pastebin.com/rJgM50FV</a></div><script src="https://pastebin.com/embed_js.php?i=rJgM50FV"></script><br>І ура, все працює, можна насолоджуватись правильним відмінюванням. Отже, наш перероблений скрипт <b>comments-count.js</b>:<br><br><div class="pastebin">Код з <a href="http://pastebin.com/r7xKQVeS">http://pastebin.com/r7xKQVeS</a></div><script src="https://pastebin.com/embed_js.php?i=r7xKQVeS"></script><br>І перероблений скрипт у футері сайту, який буде звертатись до нашого скрипта:<br><br><div class="pastebin">Код з <a href="http://pastebin.com/rJgM50FV">http://pastebin.com/rJgM50FV</a></div><script src="https://pastebin.com/embed_js.php?i=rJgM50FV"></script><br><br>Все. Хай живе граматика.</cut>';
$post['hidden']='';
$post['subs']='';
$post['holdtime']='';
$post['dietime']='';
$post['close']='';
$post['nocomm']='';
$post['commhide']='';
$post['attach']='';
$post['commpriv']='';
$post['nobr']='';
?>
